#!/bin/bash

# install.sh - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ GPU –º–æ–Ω–∏—Ç–æ—Ä–∞ –¥–ª—è Hive OS
# –ó–∞–ø—É—Å–∫: bash <(curl -s https://raw.githubusercontent.com/kotee228/gpu_monitor/main/install.sh)

set -e  # –ü—Ä–µ—Ä—ã–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

echo "========================================"
echo " –£—Å—Ç–∞–Ω–æ–≤–∫–∞ GPU –º–æ–Ω–∏—Ç–æ—Ä–∞ –¥–ª—è Hive OS"
echo "========================================"

# –®–∞–≥ 1. –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏
echo "[1/5] –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫..."
mkdir -p /hive/python_scripts/gpu_monitor
cd /hive/python_scripts/gpu_monitor
echo "‚úì –ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: /hive/python_scripts/gpu_monitor"

# –®–∞–≥ 2. –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "[2/5] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
apt update > /dev/null 2>&1
apt install -y python3-venv screen > /dev/null 2>&1
echo "‚úì Python3-venv –∏ screen —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# –®–∞–≥ 3. –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "[3/5] –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
python3 -m venv venv
echo "‚úì –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ"

# –®–∞–≥ 4. –°–∫–∞—á–∏–≤–∞–µ–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∫—Ä–∏–ø—Ç
echo "[4/5] –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞..."

# –°–∫–∞—á–∏–≤–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Å GitHub
curl -s -o gpu_monitor.py https://raw.githubusercontent.com/kotee228/gpu_monitor/main/gpu_monitor.py

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x gpu_monitor.py
echo "‚úì –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"

# –®–∞–≥ 5. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ screen
echo "[5/5] –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..."

# –°–æ–∑–¥–∞–µ–º –∑–∞–ø—É—Å–∫–∞—é—â–∏–π —Å–∫—Ä–∏–ø—Ç
cat > start_monitor.sh << 'EOL'
#!/bin/bash
cd /hive/python_scripts/gpu_monitor
source venv/bin/activate
python gpu_monitor.py
EOL

chmod +x start_monitor.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤ screen
screen -dmS gpu_monitor bash -c 'cd /hive/python_scripts/gpu_monitor && ./start_monitor.sh'

echo "‚úì –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω –≤ screen —Å–µ—Å—Å–∏–∏"
echo ""
echo "========================================"
echo " –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "========================================"
echo ""
echo "üìã –ö–û–ú–ê–ù–î–´ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê:"
echo "================================================"
echo ""
echo "‚öôÔ∏è  –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:"
echo "  cd /hive/python_scripts/gpu_monitor ‚Ä¢ –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É —Å–∫—Ä–∏–ø—Ç–∞"
echo "  nano gpu_monitor.py          ‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞"
echo ""
echo "üéØ –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´ SCREEN:"
echo "  screen -S gpu_monitor        ‚Ä¢ –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é"
echo "  screen -ls                   ‚Ä¢ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π"
echo "  screen -r gpu_monitor        ‚Ä¢ –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Å—Å–∏–∏"
echo "  screen -XS gpu_monitor quit  ‚Ä¢ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é"
echo ""
echo "üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –õ–û–ì–û–í –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò:"
echo "  ‚Ä¢ –í log_status.txt –≤—Å–µ –ª–æ–≥–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)"
echo "  watch -n 1 \"head -n 10 log_status.txt\"   ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–±—ã—Ç–∏–π (–≥–¥–µ -n 1 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1 —Å–µ–∫)"
echo ""
echo "  ‚Ä¢ –í log_restart.txt —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)"
echo "  watch -n 1 \"head -n 5 log_restart.txt\"   ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ (–≥–¥–µ -n 1 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1 —Å–µ–∫)"
echo ""
echo "  ‚Ä¢ watch –æ–±–Ω–æ–≤–ª—è–µ—Ç —ç–∫—Ä–∞–Ω –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É"
echo "  ‚Ä¢ head –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–µ N —Å—Ç—Ä–æ–∫ (—Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ)"
echo ""
echo "================================================"
echo ""
echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:"
echo "  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ: 60 —Å–µ–∫"
echo "  –ü–æ—Ä–æ–≥ –º–æ—â–Ω–æ—Å—Ç–∏:   100W"
echo "  GPU –∏–Ω–¥–µ–∫—Å:       0"
echo ""
echo "–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ:"
echo "  /hive/python_scripts/gpu_monitor/gpu_monitor.py"
